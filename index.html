<!doctype html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Huizemark â€¢ Smart Match (Blessing Nsibande)</title>

  <!--
    ðŸ§¸ SIMPLE NOTES FOR FUTURE YOU (A 4-YEAR-OLD SUPERHERO)
    - This page helps BUYERS find homes and SELLERS list homes.
    - We only show results after the person proves they are real: email + phone + tiny code.
    - Buttons send a neat message to Blessing on WhatsApp or Email.
    - We keep it safe (light security), fast (no heavy scripts), and on-brand (Huizemark).
    - Your listings live in /data/listings.json and a nightly GitHub Action updates them.
    - If something breaks, read the COMMENTS belowâ€”they are tiny breadcrumbs.
  -->

  <!-- Favicon (Huizemark logo) -->
  <link rel="icon" type="image/png"
        href="https://d21tw07c6rnmp0.cloudfront.net/media/uploads/94/theme-settings/2025/5/94_8a5e0d54687d41228f79c92853b42629.png">
  <link rel="apple-touch-icon"
        href="https://d21tw07c6rnmp0.cloudfront.net/media/uploads/94/theme-settings/2025/5/94_8a5e0d54687d41228f79c92853b42629.png" />

  <!-- ðŸ” Light security (best-effort on static hosting) -->
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self' https://api.whatsapp.com https://d21tw07c6rnmp0.cloudfront.net; img-src 'self' data: https://d21tw07c6rnmp0.cloudfront.net; style-src 'self' 'unsafe-inline'; script-src 'self'; connect-src 'self'; frame-ancestors 'none'">
  <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
  <meta name="format-detection" content="telephone=no">

  <style>
    /* ðŸŽ¨ COLOURS + THEME TOKENS */
    :root{
      --hz-orange:#f58220; --hz-grey:#4d4d4d; --hz-bg:#ffffff; --hz-text:#222;
      --hz-muted:#6b7280; --hz-border:#e5e7eb; --btn-text:#fff; --card-bg:#ffffff;
      color-scheme: light dark; /* lets the browser pick UI colours nicely */
    }
    .theme-dark{
      --hz-bg:#0b0b0c; --hz-text:#eaeaea; --hz-muted:#9aa0a6; --hz-border:#2a2a2d; --card-bg:#141416;
      color-scheme: dark;
    }

    /* ðŸ§± LAYOUT + BASICS */
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial;background:var(--hz-bg);color:var(--hz-text)}
    a{color:var(--hz-orange)}
    .wrap{max-width:780px;margin:24px auto;padding:0 16px}
    .card{background:var(--card-bg);border:1px solid var(--hz-border);border-radius:12px;padding:20px;margin-top:16px}
    .brand{display:flex;align-items:center;gap:12px}.brand img{height:64px}
    .toolbar{margin-left:auto}
    label{display:block;margin:10px 0 4px;font-weight:600}
    input,select,button,textarea{font:inherit}
    input,select,textarea{width:100%;padding:12px;border:1px solid var(--hz-border);border-radius:10px;background:transparent;color:var(--hz-text)}
    /* Dark inputs/dropdowns */
    .theme-dark input,.theme-dark select,.theme-dark textarea{background:#0f0f10;color:#eaeaea;border-color:#2a2a2d}
    .theme-dark select option{background:#0f0f10;color:#eaeaea}

    .btn{background:var(--hz-orange);color:var(--btn-text);border:0;border-radius:10px;padding:12px 16px;cursor:pointer;display:inline-flex;align-items:center;gap:8px;text-decoration:none}
    .btn.secondary{background:#4d4d4d}
    .btn[aria-disabled="true"]{opacity:0.5;pointer-events:none}
    .row{display:grid;gap:12px;grid-template-columns:1fr 1fr}
    @media(max-width:640px){.row{grid-template-columns:1fr}}
    .muted{color:var(--hz-muted)}
    .results ol{padding-left:1.2rem}
    .pill{display:inline-block;background:#f8f8f8;border:1px solid var(--hz-border);border-radius:999px;padding:4px 8px;font-size:12px;margin-left:8px}
    .theme-dark .pill{background:#121214}
    .hidden{display:none}

    /* ðŸš° DETER GENTLE COPYING (not bulletproof) */
    .results { position: relative; user-select: none; }
    .results .wm {
      position:absolute; inset:0; pointer-events:none;
      background-image: repeating-linear-gradient(
        -30deg,
        rgba(245,130,32,0.08) 0px,
        rgba(245,130,32,0.08) 2px,
        transparent 2px,
        transparent 140px
      );
      mix-blend-mode: multiply;
    }
    .theme-dark .results .wm { mix-blend-mode: screen; }
    .no-select { user-select: none; }
  </style>
</head>
<body>
  <header class="wrap">
    <div class="brand">
      <img src="https://d21tw07c6rnmp0.cloudfront.net/media/uploads/94/theme-settings/2025/5/94_8a5e0d54687d41228f79c92853b42629.png" alt="Huizemark" />
      <h1 style="margin:0">Smart Match</h1>
      <div class="toolbar">
        <button id="toggleTheme" class="btn secondary" type="button">ðŸŒ™ Dark mode</button>
      </div>
    </div>
  </header>

  <main class="wrap">
    <!-- ðŸŽ¯ ROLE SWITCH: buyer OR seller -->
    <section class="card" aria-labelledby="role-title">
      <h2 id="role-title" style="margin-top:0">How can we help?</h2>
      <div role="radiogroup" aria-label="Select your goal" style="display:flex; gap:12px; flex-wrap:wrap">
        <label><input type="radio" name="role" id="roleBuyer" value="buyer" checked> Iâ€™m buying</label>
        <label><input type="radio" name="role" id="roleSeller" value="seller"> Iâ€™m selling</label>
      </div>
      <p class="muted" style="margin:8px 0 0">Choose one. Weâ€™ll show the right steps.</p>
    </section>

    <!-- ðŸ›’ BUYER: PREFERENCES -->
    <section id="buyerPrefs" class="card">
      <h2 style="margin-top:0">Your preferences</h2>
      <form id="qform" novalidate>
        <div class="row">
          <div>
            <label for="budget">Max budget (R)</label>
            <input id="budget" name="budget" inputmode="numeric" required placeholder="e.g. 1200000" />
          </div>
          <div>
            <label for="beds">Bedrooms</label>
            <select id="beds" name="beds">
              <option>2</option><option selected>3</option><option>4</option><option>5+</option>
            </select>
          </div>
        </div>
        <div class="row">
          <div>
            <label for="approved">Bond pre-approved?</label>
            <select id="approved" name="approved"><option>Yes</option><option selected>No</option></select>
          </div>
          <div>
            <label for="count">How many matches?</label>
            <select id="count" name="count"><option>1</option><option selected>3</option><option>5</option><option>10</option></select>
            <div style="margin-top:6px">
              <label><input type="checkbox" id="allowOverBudget"> Include a few slightly above budget (â‰¤ 8%)</label>
            </div>
          </div>
        </div>

        <!-- ðŸ¤– Honeypot (bots fill this; humans never see/click) -->
        <div style="position:absolute; left:-9999px; top:-9999px;">
          <label>Leave this field empty</label>
          <input id="hp" name="hp" tabindex="-1" autocomplete="off">
        </div>

        <button class="btn" type="submit">Show Matches</button>
      </form>
    </section>

    <!-- ðŸ§­ BUYER: RESULTS -->
    <section id="buyerResults" class="card results">
      <h2 style="margin-top:0">Top Matches</h2>
      <div id="out" class="muted">Complete the form to see suggested properties.</div>
      <!-- light watermark to deter lazy copying -->
      <div class="wm" aria-hidden="true"></div>
    </section>

    <!-- ðŸ  SELLER: FORM -->
    <section id="sellerCard" class="card hidden" aria-labelledby="seller-title">
      <h2 id="seller-title" style="margin-top:0">Tell us about your property</h2>

      <div class="row">
        <div>
          <label for="s_address">Street address</label>
          <input id="s_address" placeholder="e.g. 21 Trollip Road">
        </div>
        <div>
          <label for="s_suburb">Suburb / Town</label>
          <input id="s_suburb" placeholder="e.g. Brenthurst, Brakpan">
        </div>
      </div>

      <div class="row">
        <div>
          <label for="s_type">Property type</label>
          <select id="s_type">
            <option>House</option><option>Apartment</option><option>Townhouse</option>
            <option>Vacant land</option><option>Commercial</option>
          </select>
        </div>
        <div>
          <label for="s_beds">Bedrooms</label>
          <select id="s_beds">
            <option>N/A</option><option>1</option><option>2</option><option selected>3</option><option>4</option><option>5+</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div>
          <label for="s_baths">Bathrooms</label>
          <select id="s_baths">
            <option>N/A</option><option>1</option><option selected>2</option><option>3</option><option>4+</option>
          </select>
        </div>
        <div>
          <label for="s_sizes">Erf / Floor size</label>
          <input id="s_sizes" placeholder="e.g. Erf 500mÂ², Floor 180mÂ²">
        </div>
      </div>

      <div class="row">
        <div>
          <label for="s_upgrades">Upgrades / features</label>
          <input id="s_upgrades" placeholder="e.g. New kitchen 2023, solar, flatlet">
        </div>
        <div>
          <label for="s_price">Target sale price (R)</label>
          <input id="s_price" inputmode="numeric" placeholder="e.g. 1450000">
        </div>
      </div>

      <div class="row">
        <div>
          <label for="s_timeline">When do you want to sell?</label>
          <select id="s_timeline">
            <option selected>As soon as possible</option>
            <option>Within 30 days</option>
            <option>1â€“3 months</option>
            <option>3+ months</option>
          </select>
        </div>
        <div>
          <label for="s_links">Photos / video links (optional)</label>
          <input id="s_links" placeholder="e.g. Google Drive, Dropbox, YouTube">
        </div>
      </div>

      <!-- ðŸ¤– Honeypot for seller too -->
      <div style="position:absolute; left:-9999px; top:-9999px;">
        <label>Leave this field empty</label>
        <input id="hp2" name="hp2" tabindex="-1" autocomplete="off">
      </div>

      <p class="muted">Weâ€™ll verify your contact details below, then you can message Blessing instantly.</p>
    </section>

    <!-- ðŸ“ž SHARED: CONTACT + VERIFICATION + SEND -->
    <section id="verifyCard" class="card hidden" aria-live="polite">
      <h2 style="margin-top:0">Contact & verification <span class="pill">Required</span></h2>

      <div class="row">
        <div><label for="name">Your name</label><input id="name" autocomplete="name" placeholder="e.g. Thabo M."></div>
        <div>
          <label for="email">Your email</label>
          <input id="email" type="email" autocomplete="email" placeholder="you@example.com" />
          <div id="emailErr" class="muted" style="color:#b91c1c" hidden>Enter a valid email address.</div>
        </div>
      </div>

      <div class="row" style="margin-top:8px">
        <div>
          <label for="phone">Your phone (WhatsApp)</label>
          <input id="phone" inputmode="tel" autocomplete="tel" placeholder="082 123 4567 or +27 82 123 4567" />
          <div id="phoneErr" class="muted" style="color:#b91c1c" hidden>Enter a valid SA mobile number (e.g. 082â€¦ / +27 82â€¦).</div>
        </div>
        <div>
          <label for="cta">What next?</label>
          <select id="cta">
            <option selected>Arrange a viewing</option>
            <option>Request more photos/videos</option>
            <option>Get bond pre-approval help</option>
            <option>Call me back</option>
            <option>Free valuation (seller)</option>
            <option>Book listing appointment (seller)</option>
          </select>
        </div>
      </div>

      <div class="row" style="margin-top:8px">
        <div>
          <label for="chk">Type this code to prove youâ€™re real</label>
          <div style="display:flex;gap:8px;align-items:center">
            <code id="code" style="font-weight:700; font-size:1.05rem">SM-000000</code>
            <button id="regen" type="button" class="btn secondary" style="padding:8px 12px">â†» New code</button>
          </div>
          <input id="chk" placeholder="Type the code above exactly" aria-describedby="veriMsg" />
          <div id="veriMsg" class="muted" style="margin-top:4px" hidden>Code does not match.</div>
        </div>
        <div style="display:flex;align-items:center">
          <label><input type="checkbox" id="consent"> I consent to Huizemark storing my details (POPIA)</label>
        </div>
      </div>

      <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px">
        <a id="btnWA"   class="btn"           target="_blank" rel="noopener" aria-disabled="true">WhatsApp Blessing</a>
        <a id="btnMail" class="btn secondary"                     aria-disabled="true">Email Blessing</a>
      </div>
      <p class="muted" id="helper" style="margin:6px 0 0">Fill details, pass verification, then buttons will unlock.</p>

      <p class="muted" style="margin:12px 0 0">
        View all of Blessingâ€™s listings:
        <a href="https://www.huizemark.com/agents/blessing-nsibande/75570/" target="_blank" rel="noopener">
          Blessing Nsibande â€¢ Huizemark
        </a>
      </p>
    </section>
  </main>

  <footer class="wrap">
    <div class="card">
      <p class="muted" style="margin:0">
        View all of Blessingâ€™s Huizemark listings:
        <a href="https://www.huizemark.com/agents/blessing-nsibande/75570/" target="_blank" rel="noopener">
          Blessing Nsibande â€¢ Huizemark
        </a>
      </p>
    </div>
  </footer>

  <script>
    /* ======================
       ðŸ§  CONFIG (CHANGE ME)
       ====================== */
    const AGENT_PHONE_E164 = '27662729016';                // WhatsApp (no '+')
    const AGENT_EMAIL      = 'blessing@huizemark.co.za';   // Email
    const STOCK_URL        = '/data/listings.json';        // Your nightly-updated stock

    /* ======================
       ðŸŒ™ THEME (SAVED)
       ====================== */
    (function(){
      const root = document.documentElement, btn = document.getElementById('toggleTheme');
      const saved = localStorage.getItem('sm-theme');
      if(saved==='dark') root.classList.add('theme-dark');
      const label = () => btn.textContent = root.classList.contains('theme-dark') ? 'â˜€ï¸ Light mode' : 'ðŸŒ™ Dark mode';
      label();
      btn.addEventListener('click', ()=>{
        root.classList.toggle('theme-dark');
        localStorage.setItem('sm-theme', root.classList.contains('theme-dark')?'dark':'light');
        label();
      });
    })();

    /* ======================
       ðŸ” DETER EASY COPYING
       ====================== */
    // We keep accessibility: we allow right-click in input fields for paste, etc.
    document.addEventListener('contextmenu', e => {
      const t = e.target;
      if (t && (t.tagName === 'INPUT' || t.tagName === 'TEXTAREA' || t.isContentEditable)) return;
      e.preventDefault();
    });
    document.addEventListener('keydown', e => {
      const ctrl = e.ctrlKey || e.metaKey;
      const inField = ['INPUT','TEXTAREA','SELECT'].includes((e.target||{}).tagName);
      if (!inField) {
        const k = e.key.toLowerCase();
        if ( (ctrl && (k==='s' || k==='u' || k==='p')) || e.key==='F12' || (ctrl && e.shiftKey && k==='i') ) {
          e.preventDefault();
          e.stopPropagation();
        }
      }
    });

    /* ======================
       ðŸ§° HELPERS
       ====================== */
    const $ = sel => document.querySelector(sel);
    const fmtRand = n => 'R' + Number(n||0).toLocaleString('en-ZA');
    const bedsLbl = v => (v==null? 'N/A' : String(v));
    const numeric = v => parseInt(String(v||'').replace(/\D/g,'' )||'0',10);
    const join2   = arr => arr.filter(Boolean).join('\n\n');

    // SA mobile â†’ E.164 (e.g., 082... => 2782...)
    function normaliseSAMobile(input){
      if(!input) return null;
      const digits = String(input).replace(/\D/g,'');
      if(digits.startsWith('27') && digits.length===11) return digits;              // 27XXXXXXXXX
      if(digits.startsWith('0')  && digits.length===10) return '27'+digits.slice(1);// 0XXXXXXXXX -> 27XXXXXXXXX
      if(digits.length===11 && digits.startsWith('278')) return digits;             // already ok
      return null;
    }
    function validateEmail(e){
      return /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/.test(String(e||'').trim());
    }

    async function loadStock(){
      try{ const r = await fetch(STOCK_URL,{cache:'no-store'}); if(!r.ok) throw 0; return await r.json(); }
      catch(_){ return []; }
    }

    /* ======================
       ðŸ§® MATCH SCORING
       ====================== */
    function scoreLead(ans,x){
      let s=0;
      if(numeric(ans.budget) >= (x.price||Infinity)) s+=15;
      const want = parseInt(String(ans.beds||'2').replace('+','')||'2',10);
      if(want <= (x.beds||0)) s+=10;
      if(String(ans.approved).toLowerCase()==='yes') s+=60;
      return s;
    }
    const sortStrictByCloseness = (budget)=>(a,b)=>{
      const da = budget - (a.x.price||0), db = budget - (b.x.price||0);
      if(da!==db) return da-db;
      if((b.x.price||0)!==(a.x.price||0)) return (b.x.price||0)-(a.x.price||0);
      return b.score-a.score;
    };
    const sortNearByCloseness = (budget)=>(a,b)=>{
      const da = (a.x.price||Infinity)-budget, db = (b.x.price||Infinity)-budget;
      if(da!==db) return da-db;
      if((b.x.price||0)!==(a.x.price||0)) return (b.x.price||0)-(a.x.price||0);
      return b.score-a.score;
    };

    /* ======================
       ðŸ“¨ MESSAGE BUILDERS
       ====================== */
    let baseSummary = '';   // buyer: prefs + matches (no PII)
    let fullSummary = '';   // buyer: + PII/CTA if consent

    function buildBuyerBaseSummary(ans, chosen){
      const budgetNum = numeric(ans.budget);
      const blocks = chosen.map(m => [
        `â€¢ ${m.x.title}`,
        `  WebRef: ${m.x.ref||'â€”'}`,
        `  Price: ${fmtRand(m.x.price)}`,
        `  Beds: ${bedsLbl(m.x.beds)}`,
        `  Area: ${m.x.area||''}`,
        `  Link: ${m.x.url}`
      ].join('\n'));
      baseSummary = join2([
        `Lead Type: BUYER`,
        `Hi Blessing, please see my Smart Match results:`,
        `Budget: ${fmtRand(budgetNum)}`,
        `Beds wanted: ${ans.beds}`,
        `Pre-approved: ${ans.approved}`,
        ``,
        `Matches:`,
        ...blocks
      ]);
    }

    function buildBuyerFullSummary(){
      const parts = [baseSummary, '---'];
      if($('#consent').checked){
        const nm = $('#name').value.trim(), em = $('#email').value.trim(), ph = $('#phone').value.trim();
        if(nm || em || ph){ parts.push('BUYER DETAILS'); }
        if(nm) parts.push(`Name: ${nm}`);
        if(em) parts.push(`Email: ${em}`);
        if(ph) parts.push(`Phone: ${ph}`);
      }
      const cta = $('#cta').value;
      parts.push(`Next step: ${cta}`);
      const det = ''; // keep empty; add if you later add a CTA details field
      if(det) parts.push(`Details: ${det}`);
      fullSummary = join2(parts);
      return fullSummary || baseSummary;
    }

    function buildSellerSummary(){
      const p = {
        addr:  $('#s_address').value.trim(),
        sub:   $('#s_suburb').value.trim(),
        type:  $('#s_type').value,
        beds:  $('#s_beds').value,
        baths: $('#s_baths').value,
        sizes: $('#s_sizes').value.trim(),
        upg:   $('#s_upgrades').value.trim(),
        price: $('#s_price').value.trim(),
        tl:    $('#s_timeline').value,
        links: $('#s_links').value.trim(),
      };

      const parts = [
        'Lead Type: SELLER',
        'Hi Blessing, I want to list my property with Huizemark.',
        `Address: ${p.addr || 'â€”'}`,
        `Suburb: ${p.sub || 'â€”'}`,
        `Type: ${p.type}`,
        `Beds/Baths: ${p.beds} / ${p.baths}`,
        `Sizes: ${p.sizes || 'â€”'}`,
        `Upgrades: ${p.upg || 'â€”'}`,
        `Target price: ${p.price ? 'R' + Number(p.price.replace(/\D/g,'')||0).toLocaleString('en-ZA') : 'â€”'}`,
        `Timeline: ${p.tl}`,
        p.links ? `Links: ${p.links}` : null,
        '---'
      ].filter(Boolean);

      if($('#consent').checked){
        const nm = $('#name').value.trim(), em = $('#email').value.trim(), ph = $('#phone').value.trim();
        if(nm || em || ph){ parts.push('OWNER DETAILS'); }
        if(nm) parts.push(`Name: ${nm}`);
        if(em) parts.push(`Email: ${em}`);
        if(ph) parts.push(`Phone: ${ph}`);
      }
      const cta = $('#cta').value;
      parts.push(`Next step: ${cta}`);
      return parts.join('\n');
    }

    /* ======================
       âœ… VERIFICATION
       ====================== */
    let challenge = 'SM-000000';
    function newCode(){
      const n = Math.floor(Math.random()*900000)+100000; // 6 digits
      challenge = 'SM-' + n;
      $('#code').textContent = challenge;
      $('#chk').value = '';
      setVeriMessage('');
    }
    function setVeriMessage(msg, ok=false){
      const el = $('#veriMsg');
      if(!msg){ el.hidden = true; el.textContent=''; return; }
      el.hidden = false;
      el.textContent = msg;
      el.style.color = ok ? '#15803d' : '#b91c1c';
    }
    function setEmailError(show){ $('#emailErr').hidden = !show; }
    function setPhoneError(show){ $('#phoneErr').hidden = !show; }

    function isVerified(){
      const emailOK = validateEmail($('#email').value.trim());
      setEmailError(!emailOK);
      const phoneE164 = normaliseSAMobile($('#phone').value.trim());
      const phoneOK = !!phoneE164;
      setPhoneError(!phoneOK);
      const codeOK = $('#chk').value.trim().toUpperCase() === challenge.toUpperCase();
      setVeriMessage(codeOK ? 'Verified âœ“' : ($('#chk').value ? 'Code does not match.' : ''), codeOK);
      return emailOK && phoneOK && codeOK;
    }

    function toggleSendButtons(enabled){
      $('#btnWA').setAttribute('aria-disabled', enabled ? 'false' : 'true');
      $('#btnMail').setAttribute('aria-disabled', enabled ? 'false' : 'true');
    }

    function currentMessageText(){
      if($('#roleSeller').checked){
        return buildSellerSummary();
      } else {
        return buildBuyerFullSummary();
      }
    }
    function updateAnchors(){
      const text = encodeURIComponent(currentMessageText());
      $('#btnWA').href   = `https://api.whatsapp.com/send?phone=${AGENT_PHONE_E164}&text=${text}`;
      $('#btnMail').href = `mailto:${AGENT_EMAIL}?subject=${encodeURIComponent('Smart Match Lead')}&body=${text}`;
    }

    /* ======================
       ðŸ”€ UI TOGGLES
       ====================== */
    function showBuyer(){
      $('#buyerPrefs').classList.remove('hidden');
      $('#buyerResults').classList.remove('hidden');
      $('#sellerCard').classList.add('hidden');
      $('#verifyCard').classList.add('hidden'); // shown after buyer gets matches
    }
    function showSeller(){
      $('#buyerPrefs').classList.add('hidden');
      $('#buyerResults').classList.add('hidden');
      $('#sellerCard').classList.remove('hidden');
      $('#verifyCard').classList.remove('hidden'); // seller verifies & sends immediately
      newCode(); toggleSendButtons(false); updateAnchors();
      $('#helper').textContent = 'Fill a valid email, SA mobile, and type the code to unlock sending.';
    }

    /* ======================
       ðŸ§© MAIN
       ====================== */
    (async function(){
      const STOCK = await loadStock();

      // Role switch
      $('#roleBuyer').addEventListener('change', e=>{ if(e.target.checked) showBuyer(); });
      $('#roleSeller').addEventListener('change', e=>{ if(e.target.checked) showSeller(); });
      showBuyer();

      // Code regen
      $('#regen').addEventListener('click', newCode);
      newCode();

      // Live validation + link updates
      ['input','change','keyup'].forEach(evt=>{
        ['#name','#email','#phone','#consent','#cta','#chk'].forEach(sel=>{
          document.querySelector(sel).addEventListener(evt, ()=>{
            const ok = isVerified();
            toggleSendButtons(ok);
            updateAnchors();
            $('#helper').textContent = ok
              ? 'Verified. You can send via WhatsApp or Email.'
              : 'Fill a valid email, SA mobile, and type the code to unlock sending.';

            // If user submitted buyer prefs but was gated, show results once verified
            if (ok && window.pendingAns) {
              computeAndRenderMatches(STOCK, window.pendingAns);
              window.pendingAns = null;
            }
          });
        });
      });

      // Remember pending buyer answers until verified
      window.pendingAns = null;

      // Buyer matching with strict lead gate
      document.getElementById('qform').addEventListener('submit', (e)=>{
        e.preventDefault();

        // Bot honeypot
        if ((document.getElementById('hp').value||'').trim() !== '') {
          alert('Submission blocked.');
          return;
        }

        const ans = Object.fromEntries(new FormData(e.target).entries());
        if (!numeric(ans.budget)) {
          alert('Please enter your budget (numbers only).');
          document.getElementById('budget').focus();
          return;
        }

        const ok = isVerified();
        if (!ok) {
          document.getElementById('verifyCard').classList.remove('hidden');
          document.getElementById('helper').textContent = 'Verify your email, SA mobile, and code to see your matches.';
          document.getElementById('chk').focus();
          window.pendingAns = ans;            // remember answers
          toggleSendButtons(false);
          updateAnchors();
          return;
        }

        // Already verified? Show now.
        window.pendingAns = null;
        computeAndRenderMatches(STOCK, ans);
      });
    })();
  </script>

  <!--
    ðŸ§± SCALABILITY & MAINTENANCE (EXPLAINED LIKE LEGO)
    - To change Blessingâ€™s phone/email: edit AGENT_PHONE_E164 / AGENT_EMAIL above (2 LEGO blocks).
    - To use with another agent: copy this file, change agent bits + point to THEIR /data/listings.json.
    - To keep stock fresh: GitHub Action runs fetch_stock.py nightly and writes /data/listings.json.
    - To add more fields to messages: edit the message builders (tiny pieces under â€œMESSAGE BUILDERSâ€).
    - To stop more bots later: swap the human code for Cloudflare Turnstile (free) without changing the UI.
    - To host anywhere: this is a single HTML file; just upload + keep the /data folder next to it.
    - To test safely: open in a private tab on phone + desktop, try both buyer and seller flows.
    - To roll out to a whole office: templatize phone/email/logo â†’ generate one per agent (SaaS-ready).
  -->
</body>
</html>
